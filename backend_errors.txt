==============================================================================================================================================

1. 

The post request that caused this was:
{
"text_query":"food"
"lat_sw":32.10119
"lng_sw":-124.804688
"lat_ne":46.920255
"lng_ne":-73.828125
"user_id":"user123"
"token":REDACTED
}

Seems like some location, photo, review... (not sure which) had the time in an incompatable format


INFO:     172.17.0.1:57396 - "POST /search_nearby HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/usr/local/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/usr/local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/usr/local/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/app/api_service.py", line 122, in search_nearby_places
    data = await response_formatter(result,API_KEY)
  File "/app/api_service_helper_functions.py", line 125, in response_formatter
    timestamp_objects = [datetime.fromisoformat(ts.rstrip("Z")).date() for ts in times]
  File "/app/api_service_helper_functions.py", line 125, in <listcomp>
    timestamp_objects = [datetime.fromisoformat(ts.rstrip("Z")).date() for ts in times]
ValueError: Invalid isoformat string: '2018-12-01T02:50:35.609994838'


*** update ***
I drew a huge box over America and this request got a 200:
{
"text_query":"hotels"
"lat_sw":28.07198
"lng_sw":-128.144531
"lat_ne":48.57479
"lng_ne":-68.378906
"user_id":"user123"
"token":REDACTED
}

... So maybe just the word "food" is fucky?

==============================================================================================================================================

2. 

The post request that caused this was:
{
"text_query":"food"
"lat_sw":32.589635
"lng_sw":35.024414
"lat_ne":32.813824
"lng_ne":35.592957
"user_id":"user123"
"token":REDACTED
}

Duplication of error 1 with different bounding box...
==============================================================================================================================================

3. 

The post request that caused this was:
{
"text_query":"food"
"lat_sw":15.28286
"lng_sw":44.137573
"lat_ne":15.433825
"lng_ne":44.295502
"user_id":"user123"
"token":REDACTED
}

Duplication of error 1 with different bounding box...
==============================================================================================================================================

4.

The post request that caused this was:
{
"text_query":"food"
"lat_sw":32.10119
"lng_sw":-124.804688
"lat_ne":46.920255
"lng_ne":-73.828125
# "user_id":"user123"
# "token":REDACTED
}

I accidentally pushed a request with no hardcoded user token and recieved an error.
I think its good that it stopped the request. But maybe we can have a specific error message returned to the frontend
so that I can handle it specifically and tell the user their user_id/token is the problem.

INFO:     172.17.0.1:46836 - "POST /search_nearby HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/usr/local/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/usr/local/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/usr/local/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/usr/local/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
  File "/usr/local/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
  File "/usr/local/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
  File "/app/api_service.py", line 123, in search_nearby_places
    return {"places": data}
UnboundLocalError: local variable 'data' referenced before assignment